<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StayOnTrack</title>
    <link rel="icon" href="{{ url_for('static', filename='img/favicon_sot.png') }}" type="image/x-icon">
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 0;
            background: #959595;
            margin-top: 70px; /* Add this line to create space equal to the navbar height */
        }

        .navbar {
            height: 70px; /* Ensure you set a height for the navbar */
        }

        .retention-box {
            background-color: #484848;
            color: #f8b21a;
            width: 740px;  /* Set a fixed width to ensure both boxes have the same size */
            padding: 60px; /* Consistent padding */
            border-radius: 15px;
            text-align: center;
            font-size: 2.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: 4px solid #f8b21a;
        }

        .retention-box h3 {
            font-size: 3rem;
            font-weight: bolder;
            color: #f8b21a;
            margin-bottom: 10px;
        }

        .retention-box h5 {
            font-size: 1.2rem;
            color: #f8b21a;
        }

        .retention-box p {
            color: white;
            font-size: 1rem;
            margin-top: 10px;
        }

        /* Flex container settings to ensure equal spacing between boxes */
        .container-fluid {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px; /* Add a gap between the two boxes */
        }

        .small-text {
        font-size: 1rem; /* Adjust this value to make the text smaller */
        color: #333; /* Optional: Change the color if needed */
    }


        /* Course Summary Container Styling */
        .course-summary {
            padding: 50px;
            margin-bottom: 50px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 40px;  /* Added gap between course boxes */
        }

        .course-box {
            background-color: #484848;
            color: #F8B21A;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5rem;
            width: 350px; /* Increased width */
            height: 280px; /* Increased height */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: 3px solid #484848;
            font-weight: bold;
        }

        .course-box .predicted {
            font-size: 2.8rem; /* Adjusted font size */
            font-weight: bold;
            margin-bottom: 10px;
        }

        .course-box .subtext {
            font-size: 1.0rem;
            margin-bottom: 20px;

        }

        .course-box .real-and-distribution {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            padding: 0 10px;
        }

        .course-box .real-retention {
            color: #ffffff;
        }

        .course-box .distribution {
            color: #ff5757;
        }

        .real-retention {
            text-align: left;
        }

        .distribution {
            text-align: right;
        }

        .grey-text-predicted {
            color: #f1f1f1;
            font-size: 1.8rem;
        }

        /* Chart container styles */
        .chart-container {
            flex: 1 1 calc(50% - 20px);
            margin: 10px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        img {
            max-width: 100%;
            max-height: 100%;
        }

        h2 {
            margin: 40px 0;
            margin-top: 50px;
            margin-bottom: 10px;
            text-align: center;
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
            margin-bottom: 40px;
        }

        @media (max-width: 1400px) {
            .chart-container {
                flex: 1 1 100%;
            }
        }

        @media (max-width: 992px) {
            .chart-container {
                flex: 1 1 100%;
            }
        }

        #input {
            color: white;
            background-image: url("{{ url_for('static', filename='img/homebg.jpg') }}");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            height: 50vh;
            display: flex;
            align-items: center;
        }

        #input .btn {
            background-color: #f8b21a;
            border: none;
            padding: 10px 20px;
            font-size: 1.1rem;
            color: white;
            transition: background-color 0.3s ease;
        }

        #input .dl_sample {
            background-color: #000000;
            border: none;
            padding: 10px 20px;
            font-size: 1.1rem;
            color: white;
            transition: background-color 0.3s ease;
        }

        .container {
            max-width: 1900px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Custom styles for course retention summary */
        .course-summary {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        #dashboard {
        display: flex;
        justify-content: space-around;
        padding: 20px;
        background: #959595;
        }

        .dashboard-box {
            width: 20%; /* Adjust width for 4 containers */
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            border: 3px solid #484848;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 70px;

            display: flex;
            justify-content: center; /* Horizontal centering */
            align-items: center; /* Vertical centering */
            flex-direction: column;
            
        }

        .dashboard-box h6 {
            font-size: 1rem;
            font-weight: bolder;
            color: #f8b21a;
        }

        .dashboard-box h3 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .dashboard-box .icon {
            margin-top: 10px;
        }

        .dashboard-box .icon img {
            width: 40px;
            height: 40px;
        }

    </style>
</head>
<body>
    <!-- Nav Bar Section -->
    <section id="nav-bar">
        <nav class="navbar fixed-top navbar-expand-md navbar-light bg-light">
            <div class="container">
                <a href="/" class="navbar-brand mb-0 h1">
                    <img
                        class="d-inline-block align-top"
                        src="{{ url_for('static', filename='img/logo.png') }}"
                        width="30"
                        height="50"
                        alt="Logo"
                    />
                </a>
                <!-- Toggler for mobile screens -->
                <button
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarNav"
                class="navbar-toggler"
                aria-controls="navbarNav"
                aria-expanded="false"
                aria-label="Toggle navigation"
                >
                <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Collapsible menu -->
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('metricspage') }}">Metrics</a>
                        </li>
                    </ul>
                </div>
                <div>
                    <button class="btn btn-outline-secondary ms-3" onclick="captureResults()">
                        Download Results
                    </button>
                </div>
            </div>
        </nav>
    </section>

<div id="results-section">
    <!-- Dashboard Section -->
    <section id="dashboard" class="d-flex justify-content-around mt-3 mb-4">
        <!-- 1st Container: School Year and Institute -->
        <div class="dashboard-box shadow-sm p-3 mb-5 rounded text-center">
            <h6>School Year & Institute</h6>
            <h3>{{ institute }} | {{ school_year }}</h3>
        </div>

        <!-- 2nd Container: Year Level -->
        <div class="dashboard-box shadow-sm p-3 mb-5 rounded text-center">
            <h6>Year Level</h6>
            <div>
                {% if year_levels %}
                    {% for year in year_levels %}
                        <h3>
                            {% if loop.index == 1 %}
                                1st Year
                            {% elif loop.index == 2 %}
                                2nd Year
                            {% elif loop.index == 3 %}
                                3rd Year
                            {% elif loop.index == 4 %}
                                4th Year
                            {% else %}
                                {{ loop.index }}th Year
                            {% endif %}
                        </h3>
                    {% endfor %}
                {% else %}
                    <h3>N/A</h3>
                {% endif %}
            </div>
        </div>

        <!-- 2nd Container: Total Number of Students -->
        <div class="dashboard-box shadow-sm p-3 mb-5 rounded text-center">
            <h6>Total Students</h6>
            <h3>{{ overall_total_students }}</h3>
        </div>

        <!-- 3rd Container: Total Number of Courses -->
        <div class="dashboard-box shadow-sm p-3 mb-5 rounded text-center">
            <h6>Total Courses</h6>
            <h3>{{ total_courses }}</h3>
        </div>

        <!-- 4th Container: Real Retention Rate -->
        <div class="dashboard-box shadow-sm p-3 mb-5 rounded text-center">
            <h6>Real Retention Rate</h6>
            <h3>{{ "%.2f" % real_retention_rate }}% | {{ real_retained_students }} <span class="small-text">students</span></h3>
        </div>
    </section>

    <!-- Carousel Section -->
    <div id="retentionCarousel" class="carousel slide" data-ride="carousel" data-interval="false">
        <div class="carousel-inner">
            <!-- First slide: Overall retention prediction -->
            <div class="carousel-item active">
                <h2 class="text-center">Retention Prediction Summary (Overall)</h2>

                <div class="container-fluid d-flex justify-content-center align-items-center mt-4">
                    <!-- Overall Retention Rate Container -->
                    <div class="retention-box shadow-sm p-4 text-center" style="margin-right: 20px;">
                        <h3>{{ "%.2f" % overall_predicted_retention_rate }}%</h3>
                        <h5>Predicted Overall Retention Rate</h5>
                    </div>

                    <!-- Number of Students Predicted to Retain -->
                    <div class="retention-box shadow-sm p-4 text-center">
                        <h3>{{ overall_predicted_retained_students }}</h3>
                        <h5>Predicted Retained Students</h5>
                    </div>
                </div>

                <!-- Retention by Course Section -->
                {% if retention_by_course_summary %}
                <div class="course-summary">
                    {% for course_summary in retention_by_course_summary %}
                    <div class="course-box">
                        <div class="predicted">{{ course_summary.predicted_retained_students }}<span class="grey-text-predicted">/{{ course_summary.total_students }}</span></div>
                        <div class="subtext">{{ course_summary.course }} students predicted to retain</div>
                        <div class="real-and-distribution">
                            <div class="real-retention">{{ course_summary.real_retained_students }}<br>confirmed retained</div>
                            <div class="distribution">{{ "%.2f" % course_summary.retention_distribution }}%<br>Retention Distribution</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Additional slides: Year-level retention predictions -->
            {% for prediction in year_level_predictions %}
            <div class="carousel-item">
                <h2 class="text-center">Retention Prediction Summary (Year {{ prediction.year_level }})</h2>

                <div class="container-fluid d-flex justify-content-center align-items-center mt-4">
                    <!-- Year Level Retention Rate Container -->
                    <div class="retention-box shadow-sm p-4 text-center" style="margin-right: 20px;">
                        <h3>{{ "%.2f" % prediction.retention_rate }}%</h3>
                        <h5>Year {{ prediction.year_level }} Predicted Retention Rate</h5>
                    </div>

                    <!-- Number of Students Predicted to Retain for Year Level -->
                    <div class="retention-box shadow-sm p-4 text-center">
                        <h3>{{ prediction.predicted_retained_students }}</h3>
                        <h5>Year {{ prediction.year_level }} Predicted Retained Students</h5>
                    </div>
                </div>

                <!-- Retention by Course for Year Level -->
                {% if year_level_course_summary[prediction.year_level] %}
                <div class="course-summary">
                    {% for course_summary in year_level_course_summary[prediction.year_level] %}
                    <div class="course-box">
                        <div class="predicted">{{ course_summary.predicted_retained_students }}<span class="grey-text-predicted">/{{ course_summary.total_students }}</span></div>
                        <div class="subtext">{{ course_summary.course }} students predicted to retain (Year {{ prediction.year_level }})</div>
                        <div class="real-and-distribution">
                            <div class="real-retention">{{ course_summary.real_retained_students }}<br>confirmed retained</div>
                            <div class="distribution">{{ "%.2f" % course_summary.retention_distribution }}%<br>Retention Distribution</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <!-- Carousel controls -->
        <a class="carousel-control-prev" href="#retentionCarousel" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#retentionCarousel" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>
</div>

    <!-- Input Section Moved to Bottom -->
    <section id="input" class="py-5 bg-light">
        <div class="container d-flex align-items-center justify-content-center" style="height: 300px;">
            <div class="row">
                <div class="col-md-12 text-center">
                    <h2>Upload your Data</h2>
                    <form method="POST" action="/" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="fileInput" class="form-label">Choose an Excel file:</label>
                            <input type="file" class="form-control" id="fileInput" name="file" accept=".xlsx" required />
                        </div>
                        <a
                            href="{{ url_for('download_file', filename='download_sample_file.xlsx') }}"
                            class="btn bg-dark bg-opacity-75 dl_sample"
                        >Download sample .xlsx</a>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Saving User Progress -->
    <script>
        function saveProgress() {
            const formData = new FormData(document.getElementById('file-upload-form'));
        
            // Send the data to the server for autosaving
            fetch('/save_progress', {
                method: 'POST',
                body: formData,
            }).then(response => response.json())
            .then(data => {
                console.log('Progress saved:', data);
            });
        }
        
        // Save progress every 30 seconds
        setInterval(saveProgress, 30000);  // 30-second interval
        </script>

    <!-- HTML2Canvas Script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        function captureResults() {
            html2canvas(document.getElementById('results-section')).then(function(canvas) {
                var link = document.createElement('a');
                link.href = canvas.toDataURL();
                link.download = 'Results.png';
                link.click();
            });
        }
    </script>
    
    <!-- Bootstrap JS and dependencies (Optional) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
